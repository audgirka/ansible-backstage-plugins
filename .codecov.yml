# Codecov configuration for ansible-backstage-plugins
coverage:
  ignore:
    - "packages/**/*"           # Ignore all files in packages directory
    - "node_modules/**/*"       # Ignore node_modules
    - "dist/**/*"               # Ignore build output
    - "build/**/*"              # Ignore build output
    - "coverage/**/*"           # Ignore coverage reports
    - "**/*.test.ts"            # Ignore test files
    - "**/*.test.tsx"           # Ignore test files
    - "**/*.spec.ts"            # Ignore spec files
    - "**/*.spec.tsx"           # Ignore spec files
    - "**/*.stories.ts"         # Ignore storybook files
    - "**/*.stories.tsx"        # Ignore storybook files
    - "examples/**/*"           # Ignore examples
    - "docs/**/*"               # Ignore documentation
    - "**/mock/*" 
    - "**/dynamic/*"
    - "**/mock*.ts"
    - "**/Mock*.ts"
 
  # Coverage targets
  status:
    project:
      default:
        target: 70%              # Target 70% coverage for the project
        threshold: 5%            # Allow 5% drop in coverage
      plugins:
        target: 80%              # Higher target for plugins specifically
        threshold: 5%
        flags:
          - plugins
      e2e:
        target: auto             # Auto target for e2e coverage
        threshold: 10%
        flags:
          - e2e
    patch:
      default:
        target: 80%              # Target 80% coverage for new code
        threshold: 10%           # Allow 10% drop for patches

# Add dedicated flags for different coverage types
flags:
  plugins:
    paths:
      - "plugins/"
    carryforward: true
  e2e:
    paths:
      - "e2e-tests/"
    carryforward: true

# Comment configuration with enhanced layout
comment:
  layout: "header,diff,flags,components,tree,footer"
  behavior: default
  require_changes: false
  show_carryforward_flags: true

# GitHub Checks integration
github_checks:
  annotations: true

# Pull Request comment settings
parsers:
  gcov:
    branch_detection:
      conditional: yes
      loop: yes
      macro: no
      method: no
